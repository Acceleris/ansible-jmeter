---
- hosts: all

  vars:
    jmeter_version: 3.0

  pre_tasks:
    - name: Ensure build dependencies are installed (RedHat).
      yum: name=which state=present
      when: ansible_os_family == 'RedHat'

  roles:
    - role_under_test

#  vars:
#      todo_enabled: no

  tasks:
    - name: Check jmeter
      command: which /usr/local/jmeter/apache-jmeter-{{ jmeter_version }}/bin/jmeter
      register: jmeter_path

    - debug:
        msg: "Jmeter was installed in {{jmeter_path.stdout}}"

    - fail:
        msg: "Jmeter Not Found, tests failed."
      when: jmeter_path.stdout != "/usr/local/jmeter/apache-jmeter-{{ jmeter_version }}/bin/jmeter"

    - name: Display jmeter version
      command: /usr/local/jmeter/apache-jmeter-{{ jmeter_version }}/bin/jmeter --version
